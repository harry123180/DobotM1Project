# DobotM1Project å•Ÿå‹•å·¥å…·éœ€æ±‚è¦ç¯„

## å°ˆæ¡ˆæ¦‚è¿°

### å°ˆæ¡ˆæ¶æ§‹
```
DobotM1Project/
â”œâ”€â”€ ModbusServer/
â”‚   â””â”€â”€ TCPServer.py           # ä¸»è¦Modbus TCPæœå‹™å™¨ (ç«¯å£502)
â”œâ”€â”€ Automation/                # å„æ¨¡çµ„ä¸»ç›®éŒ„
â”‚   â”œâ”€â”€ CCD1/
â”‚   â”‚   â””â”€â”€ CCD1VisionCode_Enhanced.py
â”‚   â”œâ”€â”€ CCD3/
â”‚   â”‚   â””â”€â”€ CCD3AngleDetection.py
â”‚   â”œâ”€â”€ Gripper/
â”‚   â”‚   â”œâ”€â”€ Gripper.py
â”‚   â”‚   â”œâ”€â”€ Gripper_app.py
â”‚   â”‚   â””â”€â”€ gripper_config.json
â”‚   â”œâ”€â”€ light/
â”‚   â”‚   â”œâ”€â”€ LED_main.py
â”‚   â”‚   â”œâ”€â”€ LED_app.py
â”‚   â”‚   â””â”€â”€ led_config.json
â”‚   â”œâ”€â”€ VP/
â”‚   â”‚   â”œâ”€â”€ VP_main.py
â”‚   â”‚   â”œâ”€â”€ VP_app.py
â”‚   â”‚   â””â”€â”€ vp_config.json
â”‚   â””â”€â”€ XC100/
â”‚       â”œâ”€â”€ XCModule.py
â”‚       â”œâ”€â”€ XCApp.py
â”‚       â””â”€â”€ xc_module_config.json
â””â”€â”€ start/                     # æ–°å»ºå•Ÿå‹•å·¥å…·ç›®éŒ„
    â”œâ”€â”€ start.py               # ä¸»å•Ÿå‹•è…³æœ¬
    â””â”€â”€ templates/
        â””â”€â”€ index.html         # å•Ÿå‹•å·¥å…·Webä»‹é¢
```

## åŠŸèƒ½éœ€æ±‚è¦ç¯„

### 1. æ ¸å¿ƒå•Ÿå‹•åŠŸèƒ½

#### 1.1 ModbusTCPæœå‹™å™¨ç®¡æ§
- **å•Ÿå‹•é †åº**: ç¬¬ä¸€å„ªå…ˆå•Ÿå‹• `DobotM1Project/ModbusServer/TCPServer.py`
- **ç«¯å£ç›£æ§**: æª¢æ¸¬ç«¯å£502æ˜¯å¦è¢«ä½”ç”¨
- **ç‹€æ…‹æª¢æ¸¬**: å¯¦æ™‚ç›£æ§ModbusTCPæœå‹™å™¨é‹è¡Œç‹€æ…‹
- **è‡ªå‹•é‡å•Ÿ**: æœå‹™å™¨ç•°å¸¸æ™‚æä¾›æ‰‹å‹•é‡å•ŸåŠŸèƒ½

#### 1.2 æ¨¡çµ„ç®¡ç†æ¶æ§‹
```python
æ¨¡çµ„åˆ†é¡ = {
    "è¦–è¦ºæ¨¡çµ„": {
        "CCD1": "Automation/CCD1/CCD1VisionCode_Enhanced.py",
        "CCD3": "Automation/CCD3/CCD3AngleDetection.py"
    },
    "æ§åˆ¶æ¨¡çµ„": {
        "Gripper": "Automation/Gripper/Gripper.py",
        "LED": "Automation/light/LED_main.py", 
        "VP": "Automation/VP/VP_main.py",
        "XC100": "Automation/XC100/XCModule.py"
    },
    "WebUIæ¨¡çµ„": {
        "Gripper_app": "Automation/Gripper/Gripper_app.py",
        "LED_app": "Automation/light/LED_app.py",
        "VP_app": "Automation/VP/VP_app.py", 
        "XC_app": "Automation/XC100/XCApp.py"
    }
}
```

### 2. iOS Toggleé–‹é—œè¨­è¨ˆ

#### 2.1 ä¸»æ¨¡çµ„é–‹é—œå€åŸŸ
- **CCD1è¦–è¦ºæª¢æ¸¬**: iOS toggleé–‹é—œ + ç‹€æ…‹æŒ‡ç¤ºç‡ˆ
- **CCD3è§’åº¦è¾¨è­˜**: iOS toggleé–‹é—œ + ç‹€æ…‹æŒ‡ç¤ºç‡ˆ  
- **Gripperå¤¾çˆª**: iOS toggleé–‹é—œ + COMå£é¸æ“‡ä¸‹æ‹‰é¸å–® + ç‹€æ…‹æŒ‡ç¤ºç‡ˆ
- **LEDæ§åˆ¶å™¨**: iOS toggleé–‹é—œ + COMå£é¸æ“‡ä¸‹æ‹‰é¸å–® + ç‹€æ…‹æŒ‡ç¤ºç‡ˆ
- **VPéœ‡å‹•ç›¤**: iOS toggleé–‹é—œ + ç‹€æ…‹æŒ‡ç¤ºç‡ˆ
- **XC100å‡é™**: iOS toggleé–‹é—œ + COMå£é¸æ“‡ä¸‹æ‹‰é¸å–® + ç‹€æ…‹æŒ‡ç¤ºç‡ˆ

#### 2.2 WebUIé–‹é—œå€åŸŸ
- **Gripper Web**: iOS toggleé–‹é—œ + å¿«é€Ÿå°è¦½æŒ‰éˆ• (localhost:5054)
- **LED Web**: iOS toggleé–‹é—œ + å¿«é€Ÿå°è¦½æŒ‰éˆ• (localhost:5008)
- **VP Web**: iOS toggleé–‹é—œ + å¿«é€Ÿå°è¦½æŒ‰éˆ• (localhost:5053)
- **XC100 Web**: iOS toggleé–‹é—œ + å¿«é€Ÿå°è¦½æŒ‰éˆ• (localhost:5007)

### 3. COMå£è‡ªå‹•æª¢æ¸¬èˆ‡é…ç½®

#### 3.1 COMå£æƒæåŠŸèƒ½
```python
# å¯¦æ™‚æƒæç³»çµ±å¯ç”¨COMå£
def scan_com_ports():
    import serial.tools.list_ports
    ports = serial.tools.list_ports.comports()
    return [port.device for port in ports]

# é…ç½®æª”æ¡ˆè®€å–COMå£é è¨­å€¼
config_com_mapping = {
    "Gripper": "gripper_config.json -> rtu_connection.port",
    "LED": "led_config.json -> serial_connection.port", 
    "XC100": "xc_module_config.json -> xc_connection.port"
}
```

#### 3.2 COMå£ä¸‹æ‹‰é¸å–®è¨­è¨ˆ
- **é è¨­å€¼**: è®€å–å„æ¨¡çµ„configæª”æ¡ˆä¸­çš„COMå£è¨­å®š
- **ä¸‹æ‹‰é¸é …**: é¡¯ç¤ºç³»çµ±æ‰€æœ‰å¯ç”¨COMå£ (COM1, COM2, COM3...)
- **å‹•æ…‹æ›´æ–°**: 2ç§’é–“éš”é‡æ–°æƒæCOMå£åˆ—è¡¨
- **é…ç½®ä¿®æ”¹**: ç”¨æˆ¶é¸æ“‡æ–°COMå£æ™‚ï¼Œè‡ªå‹•ä¿®æ”¹å°æ‡‰configæª”æ¡ˆ

#### 3.3 é…ç½®æª”æ¡ˆä¿®æ”¹æ©Ÿåˆ¶
```python
# ç¯„ä¾‹: ä¿®æ”¹Gripperé…ç½®æª”æ¡ˆCOMå£
def update_gripper_com(new_com_port):
    config_path = "Automation/Gripper/gripper_config.json"
    with open(config_path, 'r') as f:
        config = json.load(f)
    config['rtu_connection']['port'] = new_com_port
    with open(config_path, 'w') as f:
        json.dump(config, f, indent=2)
```

### 4. è‡ªå‹•é€£æ¥ç®¡ç†

#### 4.1 CCDæ¨¡çµ„è‡ªå‹•é€£æ¥
- **CCD1**: å•Ÿå‹•å¾Œè‡ªå‹•é€£æ¥127.0.0.1:502 ModbusTCPæœå‹™å™¨
- **CCD3**: å•Ÿå‹•å¾Œè‡ªå‹•é€£æ¥127.0.0.1:502 ModbusTCPæœå‹™å™¨
- **é€£æ¥æª¢æ¸¬**: æ¯5ç§’æª¢æ¸¬é€£æ¥ç‹€æ…‹ï¼Œæ–·ç·šè‡ªå‹•é‡é€£

#### 4.2 å…¶ä»–æ¨¡çµ„å•Ÿå‹•æµç¨‹
1. ç”¨æˆ¶é¸æ“‡COMå£ (å¦‚æœ‰éœ€è¦)
2. ä¿®æ”¹å°æ‡‰configæª”æ¡ˆCOMå£åƒæ•¸
3. å•Ÿå‹•ä¸»æ¨¡çµ„è…³æœ¬
4. è‡ªå‹•é€£æ¥ModbusTCPæœå‹™å™¨ (127.0.0.1:502)

### 5. ç‹€æ…‹ç›£æ§ç³»çµ±

#### 5.1 æ¨¡çµ„ç‹€æ…‹åˆ†é¡
```python
ç‹€æ…‹å®šç¾© = {
    "åœæ­¢": {"é¡è‰²": "ç°è‰²", "åœ–ç¤º": "âš«"},
    "é‹è¡Œä¸­": {"é¡è‰²": "ç¶ è‰²", "åœ–ç¤º": "ğŸŸ¢"}, 
    "éŒ¯èª¤": {"é¡è‰²": "ç´…è‰²", "åœ–ç¤º": "ğŸ”´"},
    "é€£æ¥ä¸­": {"é¡è‰²": "é»ƒè‰²", "åœ–ç¤º": "ğŸŸ¡"}
}
```

#### 5.2 é›™ç‹€æ…‹ç›£æ§è¨­è¨ˆ
- **ä¸»æ¨¡çµ„ç‹€æ…‹**: ç›£æ§å„æ¨¡çµ„ä¸»ç¨‹åºé‹è¡Œç‹€æ…‹
- **WebUIç‹€æ…‹**: ç›£æ§å„æ¨¡çµ„Webæ‡‰ç”¨é‹è¡Œç‹€æ…‹
- **å³æ™‚æ›´æ–°**: WebSocketå³æ™‚æ¨é€ç‹€æ…‹è®ŠåŒ–

#### 5.3 ç‹€æ…‹æª¢æ¸¬æ–¹æ³•
```python
# ç¨‹åºé‹è¡Œæª¢æ¸¬
def check_process_status(script_path):
    # æª¢æŸ¥æ˜¯å¦æœ‰è©²è…³æœ¬çš„pythonç¨‹åºé‹è¡Œ
    
# TCPç«¯å£æª¢æ¸¬  
def check_web_port_status(port):
    # æª¢æŸ¥æŒ‡å®šç«¯å£æ˜¯å¦è¢«ä½”ç”¨
    
# ModbusTCPé€£æ¥æª¢æ¸¬
def check_modbus_connection(ip, port):
    # æª¢æŸ¥ModbusTCPæœå‹™å™¨é€£æ¥ç‹€æ…‹
```

### 6. å¿«é€Ÿå°è¦½åŠŸèƒ½

#### 6.1 Webä»‹é¢ç«¯å£æ˜ å°„
```python
web_ui_mapping = {
    "Gripper": {"port": 5054, "url": "http://localhost:5054"},
    "LED": {"port": 5008, "url": "http://localhost:5008"},
    "VP": {"port": 5053, "url": "http://localhost:5053"},
    "XC100": {"port": 5007, "url": "http://localhost:5007"}
}
```

#### 6.2 å¿«é€Ÿå°è¦½æŒ‰éˆ•è¨­è¨ˆ
- **æŒ‰éˆ•ç‹€æ…‹**: åƒ…åœ¨å°æ‡‰WebUIé‹è¡Œæ™‚æ‰å¯é»æ“Š
- **æ–°çª—å£é–‹å•Ÿ**: é»æ“Šå¾Œåœ¨æ–°ç€è¦½å™¨çª—å£é–‹å•Ÿå°æ‡‰Webä»‹é¢
- **ç«¯å£æª¢æ¸¬**: å¯¦æ™‚æª¢æ¸¬ç«¯å£ç‹€æ…‹ï¼Œæ›´æ–°æŒ‰éˆ•å¯ç”¨æ€§

### 7. Webä»‹é¢æŠ€è¡“è¦ç¯„

#### 7.1 å‰ç«¯æŠ€è¡“æ£§
- **æ¡†æ¶**: Flask + SocketIO
- **æ¨£å¼**: ç™½è—æ¼¸å±¤è¨­è¨ˆé¢¨æ ¼ï¼Œç°¡ç´„æ¸…æ™°
- **çµ„ä»¶**: iOSé¢¨æ ¼Toggleé–‹é—œã€ä¸‹æ‹‰é¸å–®ã€ç‹€æ…‹æŒ‡ç¤ºç‡ˆ
- **éŸ¿æ‡‰å¼**: æ”¯æ´ä¸åŒè§£æåº¦è¢å¹•

#### 7.2 å¾Œç«¯APIè¨­è¨ˆ
```python
# RESTful APIç«¯é»
@app.route('/api/modules/<module_name>/start', methods=['POST'])
@app.route('/api/modules/<module_name>/stop', methods=['POST']) 
@app.route('/api/modules/<module_name>/status', methods=['GET'])
@app.route('/api/com_ports', methods=['GET'])
@app.route('/api/config/<module_name>/com', methods=['PUT'])

# SocketIOäº‹ä»¶
socketio.on('module_status_update')
socketio.on('com_ports_scan')
socketio.on('start_module')
socketio.on('stop_module')
```

#### 7.3 å³æ™‚é€šè¨Šè¨­è¨ˆ
- **WebSocket**: ä½¿ç”¨SocketIOå¯¦ç¾å³æ™‚ç‹€æ…‹æ›´æ–°
- **å¿ƒè·³æª¢æ¸¬**: æ¯3ç§’ç™¼é€å¿ƒè·³åŒ…æª¢æ¸¬é€£æ¥
- **ç‹€æ…‹æ¨é€**: æ¨¡çµ„ç‹€æ…‹è®ŠåŒ–æ™‚å³æ™‚æ¨é€åˆ°å‰ç«¯

### 8. éŒ¯èª¤è™•ç†èˆ‡æ—¥èªŒ

#### 8.1 ç•°å¸¸è™•ç†æ©Ÿåˆ¶
- **å•Ÿå‹•å¤±æ•—**: è¨˜éŒ„å¤±æ•—åŸå› ï¼Œæä¾›é‡è©¦æŒ‰éˆ•
- **é€£æ¥ç•°å¸¸**: é¡¯ç¤ºé€£æ¥éŒ¯èª¤è¨Šæ¯ï¼Œæä¾›æ‰‹å‹•é‡é€£
- **é…ç½®éŒ¯èª¤**: æª¢æŸ¥configæª”æ¡ˆæ ¼å¼ï¼Œæç¤ºä¿®æ­£æ–¹æ³•

#### 8.2 æ—¥èªŒè¨˜éŒ„è¦ç¯„
```python
æ—¥èªŒç­‰ç´š = {
    "INFO": "æ¨¡çµ„å•Ÿå‹•/åœæ­¢/ç‹€æ…‹è®ŠåŒ–",
    "WARNING": "é€£æ¥ç•°å¸¸/é…ç½®è­¦å‘Š",  
    "ERROR": "å•Ÿå‹•å¤±æ•—/åš´é‡éŒ¯èª¤",
    "DEBUG": "è©³ç´°é™¤éŒ¯è³‡è¨Š"
}

æ—¥èªŒæ ¼å¼ = "YYYY-MM-DD HH:mm:ss [ç­‰ç´š] æ¨¡çµ„åç¨± - è¨Šæ¯å…§å®¹"
æ—¥èªŒä¿å­˜ = "logs/start_tool_YYYYMMDD.log"
```

### 9. ç¨‹åºæ¶æ§‹è¨­è¨ˆ

#### 9.1 ä¸»è¦é¡åˆ¥è¨­è¨ˆ
```python
class StartupManager:
    """å•Ÿå‹•ç®¡ç†å™¨ä¸»é¡åˆ¥"""
    def __init__(self):
        self.modules = {}
        self.modbus_server = None
        
    def start_modbus_server(self)
    def start_module(self, module_name, com_port=None)
    def stop_module(self, module_name)
    def get_module_status(self, module_name)
    def scan_com_ports(self)

class ModuleController:
    """å–®ä¸€æ¨¡çµ„æ§åˆ¶å™¨"""
    def __init__(self, name, script_path, config_path=None):
        self.name = name
        self.script_path = script_path
        self.config_path = config_path
        self.process = None
        
    def start(self, com_port=None)
    def stop(self)
    def is_running(self)
    def update_com_config(self, com_port)

class StatusMonitor:
    """ç‹€æ…‹ç›£æ§å™¨"""
    def __init__(self, socketio):
        self.socketio = socketio
        
    def start_monitoring(self)
    def check_all_status(self)
    def emit_status_update(self, module_name, status)
```

#### 9.2 é…ç½®æª”æ¡ˆç®¡ç†
```python
class ConfigManager:
    """é…ç½®æª”æ¡ˆç®¡ç†å™¨"""
    
    @staticmethod
    def read_com_port(config_path, module_type):
        """è®€å–configæª”æ¡ˆä¸­çš„COMå£è¨­å®š"""
        
    @staticmethod  
    def update_com_port(config_path, module_type, new_com):
        """æ›´æ–°configæª”æ¡ˆä¸­çš„COMå£è¨­å®š"""
        
    @staticmethod
    def validate_config(config_path):
        """é©—è­‰configæª”æ¡ˆæ ¼å¼æ­£ç¢ºæ€§"""
```

### 10. éƒ¨ç½²èˆ‡å•Ÿå‹•

#### 10.1 æª”æ¡ˆçµæ§‹
```
start/
â”œâ”€â”€ start.py                   # ä¸»å•Ÿå‹•è…³æœ¬
â”œâ”€â”€ modules/                   # æ¨¡çµ„ç®¡ç†
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ startup_manager.py     # å•Ÿå‹•ç®¡ç†å™¨
â”‚   â”œâ”€â”€ module_controller.py   # æ¨¡çµ„æ§åˆ¶å™¨  
â”‚   â”œâ”€â”€ status_monitor.py      # ç‹€æ…‹ç›£æ§å™¨
â”‚   â””â”€â”€ config_manager.py      # é…ç½®ç®¡ç†å™¨
â”œâ”€â”€ static/                    # éœæ…‹è³‡æº
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ style.css         # ç™½è—æ¼¸å±¤æ¨£å¼
â”‚   â””â”€â”€ js/
â”‚       â””â”€â”€ app.js            # å‰ç«¯é‚è¼¯
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index.html            # ä¸»ä»‹é¢æ¨¡æ¿
â”œâ”€â”€ logs/                     # æ—¥èªŒç›®éŒ„
â””â”€â”€ requirements.txt          # ä¾è³´å¥—ä»¶
```

#### 10.2 å•Ÿå‹•å‘½ä»¤
```bash
# é€²å…¥startç›®éŒ„
cd DobotM1Project/start

# å®‰è£ä¾è³´
pip install -r requirements.txt

# å•Ÿå‹•ç®¡ç†å·¥å…·
python start.py

# ç€è¦½å™¨è¨ªå•
http://localhost:8080
```

#### 10.3 ä¾è³´å¥—ä»¶æ¸…å–®
```
Flask==2.3.3
Flask-SocketIO==5.3.6
psutil==5.9.5
pyserial==3.5
requests==2.31.0
```

### 11. æ€§èƒ½èˆ‡å®‰å…¨è€ƒé‡

#### 11.1 æ€§èƒ½è¦æ±‚
- **å•Ÿå‹•æ™‚é–“**: å–®ä¸€æ¨¡çµ„å•Ÿå‹•æ™‚é–“ä¸è¶…é10ç§’
- **ç‹€æ…‹æ›´æ–°**: ç‹€æ…‹æª¢æ¸¬é–“éš”ä¸è¶…é3ç§’
- **è¨˜æ†¶é«”å ç”¨**: å•Ÿå‹•å·¥å…·è¨˜æ†¶é«”å ç”¨ä¸è¶…é100MB

#### 11.2 å®‰å…¨è€ƒé‡
- **ç«¯å£å ç”¨**: æª¢æŸ¥ç«¯å£è¡çªï¼Œé¿å…é‡è¤‡å•Ÿå‹•
- **ç¨‹åºæ¬Šé™**: æª¢æŸ¥COMå£æ¬Šé™ï¼Œæç¤ºæ¬Šé™ä¸è¶³
- **ç•°å¸¸è™•ç†**: é˜²æ­¢å•Ÿå‹•å¤±æ•—å°è‡´ç³»çµ±ç•°å¸¸

### 12. æ¸¬è©¦é©—è­‰æ¨™æº–

#### 12.1 åŠŸèƒ½æ¸¬è©¦
- [ ] ModbusTCPæœå‹™å™¨å•Ÿå‹•/åœæ­¢
- [ ] å„æ¨¡çµ„é–‹é—œæ§åˆ¶æ­£å¸¸
- [ ] COMå£é¸æ“‡èˆ‡é…ç½®ä¿®æ”¹  
- [ ] WebUIé–‹é—œèˆ‡å¿«é€Ÿå°è¦½
- [ ] ç‹€æ…‹ç›£æ§å³æ™‚æ›´æ–°

#### 12.2 æ•´åˆæ¸¬è©¦
- [ ] æ‰€æœ‰æ¨¡çµ„åŒæ™‚å•Ÿå‹•æ¸¬è©¦
- [ ] å„æ¨¡çµ„WebUIåŒæ™‚é‹è¡Œ
- [ ] ç³»çµ±ç•°å¸¸æ¢å¾©æ¸¬è©¦
- [ ] é•·æ™‚é–“é‹è¡Œç©©å®šæ€§æ¸¬è©¦

#### 12.3 ç”¨æˆ¶é«”é©—æ¸¬è©¦
- [ ] ä»‹é¢æ“ä½œç›´è§€æ€§
- [ ] ç‹€æ…‹é¡¯ç¤ºæ¸…æ™°åº¦
- [ ] éŒ¯èª¤æç¤ºå‹å–„æ€§
- [ ] éŸ¿æ‡‰é€Ÿåº¦æ»¿æ„åº¦

### 13. ç¶­è­·èˆ‡æ“´å±•

#### 13.1 ç‰ˆæœ¬ç®¡ç†
- **ç‰ˆæœ¬è™Ÿ**: æ¡ç”¨èªç¾©åŒ–ç‰ˆæœ¬æ§åˆ¶ (MAJOR.MINOR.PATCH)
- **æ›´æ–°æ—¥èªŒ**: è¨˜éŒ„æ¯æ¬¡ç‰ˆæœ¬è®Šæ›´å…§å®¹
- **å‘å¾Œç›¸å®¹**: ç¢ºä¿æ–°ç‰ˆæœ¬èˆ‡ç¾æœ‰æ¨¡çµ„ç›¸å®¹

#### 13.2 æ“´å±•æ€§è¨­è¨ˆ
- **æ¨¡çµ„åŒ–æ¶æ§‹**: æ–°å¢æ¨¡çµ„æ™‚åƒ…éœ€ä¿®æ”¹é…ç½®æª”æ¡ˆ
- **æ’ä»¶å¼è¨­è¨ˆ**: æ”¯æ´ç¬¬ä¸‰æ–¹æ¨¡çµ„æ¥å…¥
- **APIæ¨™æº–åŒ–**: çµ±ä¸€çš„æ¨¡çµ„æ§åˆ¶ä»‹é¢